---
import BaseLayout from "../layouts/BaseLayout.astro";
import { PrismaClient } from "@prisma/client";
const prisma = new PrismaClient();
const products = await prisma.product.findMany({ where: { active: true } });
const orgJsonLd = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Paint Store",
  "url": Astro.site?.toString(),
  "logo": Astro.site?.origin + "/logo.svg"
};
function fmt(n:number){return `$${n.toFixed(2)}`}
---
<BaseLayout title="Catálogo — USD" description="Catálogo base en USD (Paso 1 del MVP)" jsonld={orgJsonLd}>
  <link rel="stylesheet" href="/fonts.css" />
  <header class="container">
    <span class="logo"></span>
    <div>
      <div class="badge">MVP Paso 1</div>
      <h1>Catálogo (USD)</h1>
      <p style="color:var(--muted)">Precios calculados en USD (margen incluido). VES se añade en Paso 2.</p>
    </div>
  </header>
  <main class="container card">
    <table class="table">
      <thead><tr><th>SKU</th><th>Producto</th><th>Presentación</th><th>USD</th></tr></thead>
      <tbody>
        {products.map((p) => {
          const precioUsd = Number(p.costBaseUsd) * (1 + Number(p.margin));
          return (
            <tr>
              <td>{p.sku}</td>
              <td>{p.name}</td>
              <td>{p.sizeMl} ml</td>
              <td>{fmt(precioUsd)}</td>
            </tr>
          );
        })}
      </tbody>
    </table>
  </main>
</BaseLayout>